  TITLE, "FACET2"

! *** OPTICS=FACET2-28JAN2026 ***

  OPTION, -ECHO, INFO, WARN, VERIFY
  ASSIGN, ECHO="test.echo"
  ASSIGN, PRINT="test.print"

  SETPLOT, XSIZE=25.4, YSIZE=20.32
  SETPLOT, LWIDTH=5, LSCALE=1.5, SSCALE=1.5, RSCALE=1.5, ASCALE=1.5

! Note: all SURVEY outputs in linac coordinates

! ==============================================================================

 !F2_ELEC     : e- gun to LI20 dump (PAX chicane bypassed)
 !F2_ELEC_PAX : e- gun to LI20 dump
 !F2_SCAV     : e- gun to e+ production target

! ------------------------------------------------------------------------------
! element and line definitions
! ------------------------------------------------------------------------------

  CALL, FILENAME="FACET2e_master.xsif"

! ------------------------------------------------------------------------------

 !COMMENT
    BEAM, ENERGY=E0
    USE, F2_ELEC
    PRINT, FULL
    SURVEY, TAPE="test_survey.tape", &
      X0=Xc, Y0=Yc, Z0=Zc, THETA0=THETAc, PHI0=PHIc, PSI0=PSIc
    BEAM, ENERGY=Ei
    USE, FACET2e
    PRINT, FULL
    TWISS, SAVE, BETX=BXi, ALFX=AXi, BETY=BYi, ALFY=AYi, &
      TAPE="test_twiss.tape" !, RTAPE="test_rmat.tape"
    PLOT, TABLE=TWISS, HAXIS=S, VAXIS=ENERGY, &
      STYLE=100, SPLINE, FILE="test", RANGE=#S/#E, &
      TITLE="BEAMPATH=F2_ELECi"
    PLOT, TABLE=TWISS, HAXIS=S, VAXIS=BETX,BETY, &
      STYLE=100, SPLINE, FILE="test", RANGE=#S/#E, &
      TITLE="BEAMPATH=F2_ELECi"
    PLOT, TABLE=TWISS, HAXIS=S, VAXIS=DX,DY, &
      STYLE=100, SPLINE, FILE="test", RANGE=#S/#E, &
      TITLE="BEAMPATH=F2_ELECi"
    PLOT, TABLE=TWISS, HAXIS=S, VAXIS=BETX,BETY, &
      STYLE=100, SPLINE, FILE="test", RANGE=ENDBC20/MAINDUMP, &
      TITLE="LI20"
    PLOT, TABLE=TWISS, HAXIS=S, VAXIS=DX,DY, &
      STYLE=100, SPLINE, FILE="test", RANGE=ENDBC20/MAINDUMP, &
      TITLE="LI20"
 !ENDCOMMENT

! ------------------------------------------------------------------------------

  COMMENT
    BEAM, ENERGY=E0
    USE, F2_ELEC_PAX
    PRINT, FULL
    SURVEY, TAPE="test_survey.tape", &
      X0=Xc, Y0=Yc, Z0=Zc, THETA0=THETAc, PHI0=PHIc, PSI0=PSIc
    BEAM, ENERGY=Ei
    USE, FACET2e_PAX
    PRINT, FULL
    TWISS, SAVE, BETX=BXi, ALFX=AXi, BETY=BYi, ALFY=AYi, &
      TAPE="test_twiss.tape" !, RTAPE="test_rmat.tape"
    PLOT, TABLE=TWISS, HAXIS=S, VAXIS=BETX,BETY, &
      STYLE=100, SPLINE, FILE="test", RANGE=MIP/#E, &
      TITLE="LI20"
    PLOT, TABLE=TWISS, HAXIS=S, VAXIS=DX,DY, &
      STYLE=100, SPLINE, FILE="test", RANGE=ENDBC20/MAINDUMP, &
      TITLE="LI20"
  ENDCOMMENT

! ------------------------------------------------------------------------------

  COMMENT
    BEAM, ENERGY=E0
    USE, F2_SCAV
    OPTION, -WARN
      CALL, FILENAME="MFACET2s.xsif"
    OPTION, WARN
    PRINT, FULL
    SURVEY, TAPE="test_survey.tape", &
      X0=Xc, Y0=Yc, Z0=Zc, THETA0=THETAc, PHI0=PHIc, PSI0=PSIc
    BEAM, ENERGY=Ei
    USE, FACET2s
    PRINT, FULL
    TWISS, SAVE, BETX=BXi, ALFX=AXi, BETY=BYi, ALFY=AYi, &
      TAPE="test_twiss.tape" !, RTAPE="test_rmat.tape"
    PLOT, TABLE=TWISS, HAXIS=S, VAXIS=ENERGY, &
      STYLE=100, SPLINE, FILE="test", RANGE=#S/#E, &
      TITLE="BEAMPATH=F2_SCAVi"
    PLOT, TABLE=TWISS, HAXIS=S, VAXIS=BETX,BETY, &
      STYLE=100, SPLINE, FILE="test", RANGE=#S/#E, &
      TITLE="BEAMPATH=F2_SCAVi"
    PLOT, TABLE=TWISS, HAXIS=S, VAXIS=DX,DY, &
      STYLE=100, SPLINE, FILE="test", RANGE=#S/#E, &
      TITLE="BEAMPATH=F2_SCAVi"
    PLOT, TABLE=TWISS, HAXIS=S, VAXIS=BETX,BETY, &
      STYLE=100, SPLINE, FILE="test", RANGE=MSCAVEXT/#E, &
      TITLE="EP01"
    PLOT, TABLE=TWISS, HAXIS=S, VAXIS=DX,DY, &
      STYLE=100, SPLINE, FILE="test", RANGE=MSCAVEXT/#E, &
      TITLE="EP01"
  ENDCOMMENT

! ==============================================================================

  STOP  
